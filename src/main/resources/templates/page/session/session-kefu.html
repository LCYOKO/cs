
<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>kefu客服工作台</title>
    <link rel="stylesheet" href="../../../static/layui/css/layui.css">
    <link rel="stylesheet" href="../../../static/css/kefu.css">
</head>
<body class="layui-layout-body">
<div hidden id="kefu" data-avatar="" data-name=""></div>
<div class="layui-layout ">
    <div class="layui-side" style="background:#f2f2f2">
        <div class="layui-side-scroll">
            <blockquote class="layui-elem-quote layui-bg-cyan" style="color: white">正在咨询的会话</blockquote>
            <ul class="layui-unselect" id="user_list"></ul>
        </div>
    </div>
    <div class="layui-body" style="bottom:0">
        <input type="hidden" id="active-user" fid="-1"  th:attr="data-id=${session.user.id},data-name=${session.user.username}"><!-- 当前对话的用户 -->
        <div class="chat-left">
            <div class="chat-box laykefu-chat-main">
                <!--<ul th:attr="id=${session.user.id}" style="display: block" ></ul>-->
            </div>
            <div class="msg-send">
                <div class="tools-bar">
                    <i class="layui-icon" style="font-size: 30px;" id="face">&#xe60c;</i>
                    <i class="layui-icon" style="font-size: 30px;" id="image">&#xe60d;</i>
                    <i class="layui-icon" style="font-size: 30px;" id="file">&#xe61d;</i>
                    <i class="layui-icon " style="font-size: 10px;float: right;" id="trustSession">托管</i>
                    <i class="layui-icon " style="font-size: 10px;float: right;" id="closeSession">关闭会话</i>
                </div>
                <div class="msg-box">
                    <textarea class="msg-area" id="msg-area"></textarea>
                </div>
                <div class="send-area">
                    <span style="margin-left:10px;color:gray">快捷键 Enter</span>

                    <button class="layui-btn layui-btn-small layui-bg-cyan" style="float:right;margin-right:10px;height: 40px;padding: 0 15px;" id="send">
                        <i class="layui-icon">&#xe609;</i>发送
                    </button>

                </div>
            </div>
        </div>

        <div style="width:28%;height:100%;float:left;margin-left:1%">
            <div class="layui-tab layui-tab-brief" lay-filter="docDemoTabBrief">
                <ul class="layui-tab-title">
                    <li class="layui-this">知识库</li>
                    <li>常用语</li>
                </ul>
                <div class="layui-tab-content" style="height: 100px;">
                    <div class="layui-tab-item layui-show">
                        <div class="layui-form layui-form-pane">
                            <div class="layui-form-item">
                                <label class="layui-form-label">访客名</label>
                                <div class="layui-input-block">
                                    <input type="text" id="f-user" class="layui-input" readonly>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">IP</label>
                                <div class="layui-input-block">
                                    <input type="text" id="f-ip" class="layui-input" readonly>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label">地区</label>
                                <div class="layui-input-block">
                                    <input type="text" id="f-area" class="layui-input" readonly>
                                </div>
                            </div>
                            <div class="layui-form-item">
                                <label class="layui-form-label layui-bg-cyan" style="cursor: pointer;color:white" id="scroll-link">转接</label>
                            </div>
                        </div>
                    </div>
                    <div class="layui-tab-item">
                        <div class="layui-form">
                            <table class="layui-table" id="QATable" lay-filter="test">

                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- 转接提示层 -->
<div class="layui-form" id="change-box" style="display: none">
    <div class="layui-form-item" style="margin-top: 20px">
        <label class="layui-form-label">选择分组</label>
        <div class="layui-input-block" style="width: 70%" >
            <select lay-verify="required" lay-filter="group">
                <option value=""></option>
                <option value="1">售前组</option>
                <option value="2">售后组</option>
            </select>
        </div>
    </div>
</div>
<!-- 转接提示层 -->

<script src="../../../static/js/jquery-3.1.1.min.js"></script>
<script src="../../../static/layui/layui.js"></script>

<script type="text/javascript" src="../../../static/js/functions.js"></script>
<script type="text/javascript" src="../../../static/js/kefu.js"></script>
<script type="text/javascript" src="../../../static/js/mySocket.js"></script>
<script>
    var socketClient;
    init("support",$("#active-user").attr("data-name"),$("#active-user").attr("data-id"));
    $(function () {
        // 监听快捷键发送
        document.getElementById('msg-area').addEventListener('keydown', function (e) {
            if (e.keyCode != 13) return;
            e.preventDefault();  // 取消事件的默认动作
            sendMessage( $("#msg-area").val(),"support");
        });

        // 点击表情
        var index;
        $("#face").click(function (e) {
            e.stopPropagation();
            layui.use(['layer'], function () {
                var layer = layui.layer;

                var isShow = $(".layui-laykefu-face").css('display');
                if ('block' == isShow) {
                    layer.close(index);
                    return;
                }
                var height = $(".chat-box").height() - 110;
                layer.ready(function () {
                    index = layer.open({
                        type: 1,
                        offset: [height + 'px', $(".layui-side").width() + 'px'],
                        shade: false,
                        title: false,
                        closeBtn: 0,
                        area: '395px',
                        content: showFaces()
                    });
                });
            });
        });



        // 发送消息
        $("#send").click(function () {
            var msg = $("#msg-area").val()
            if ('' === msg) {
                layui.use(['layer'], function () {
                    var layer = layui.layer;
                    return layer.msg('请输入回复内容', {time: 1000});
                });
                return false;
            }
            sendMessage(msg,"support");

        });

        // hover用户
        $(".layui-unselect li").hover(function () {
            $(this).find('i').show();
        }, function () {
            $(this).find('i').hide();
        });



        //关闭当前会话
        $("#closeSession").click(function(){
            var layerIndex;
            console.log(1111)
            layerIndex = layer.confirm('确定关闭会话' , {
                title: '关闭提示',
                closeBtn: 0,
                icon: 3,
                btn: ['确定', '取消'] // 按钮
            }, function(){
                // layer.close(layerIndex);
                // layerIndex = layer.open({
                //     title: '',
                //     type: 1,
                //     area: ['30%', '40%'],
                //     content: $("#change-box")
                // });
            });

        });




        // 检测滚动，异步加载更多聊天数据
        $(".chat-box").scroll(function () {
            var top = $(".chat-box").scrollTop();
        });

    });
</script>
</body>
</html>